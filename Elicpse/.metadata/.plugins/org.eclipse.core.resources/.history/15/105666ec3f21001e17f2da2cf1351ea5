package JSonfiles;

import org.json.simple.JSONArray;
import org.json.simple.JSONObject;
import org.json.simple.parser.JSONParser;
import org.openqa.selenium.By;
import org.openqa.selenium.OutputType;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.io.FileHandler;

import net.sourceforge.tess4j.TesseractException;
import net.sourceforge.tess4j.ITesseract;
import net.sourceforge.tess4j.Tesseract;
import org.openqa.selenium.support.ui.WebDriverWait;

import java.io.File;
import java.io.FileReader;

public class JSONDataUploadTest {
    private WebDriver driver;

    public void setUp() {
        // Set the path to the chromedriver executable
        System.setProperty("webdriver.chrome.driver", "C:\\Users\\Shravani\\OneDrive\\Pictures\\Auto\\Forstu_Automation\\Browser Extention\\chromedriver.exe");
        // Initialize ChromeDriver instance
        driver = new ChromeDriver();
    }

    public void login(String username, String password) {
        try {
            // Open URL Of "Vidyasarthi"
            driver.get("https://www.vidyasaarathi.co.in/Vidyasaarathi/index");
        
            // Handle the PopUp
            driver.findElement(By.xpath("//*[@id=\"modalSocial\"]/div/div/div[3]/a")).click();
          
            // Login to Vidyasarthi
            driver.findElement(By.xpath("//*[@id=\"bs-example-navbar-collapse-1\"]/ul/li[8]/a")).click();
        
            // Switch to the new page
            String mainWindowHandle = driver.getWindowHandle();
            for (String handle : driver.getWindowHandles()) {
                if (!handle.equals(mainWindowHandle)) {
                    driver.switchTo().window(handle);
                    break;
                }
            }
        
            // Fill in the login credentials
            driver.findElement(By.id("username")).sendKeys(username);
            driver.findElement(By.name("password")).sendKeys(password);
            Thread.sleep(2000);
        
            // Capture CAPTCHA screenshot
            File src = driver.findElement(By.xpath("//*[@id=\"command\"]/div[8]/div[1]/div")).getScreenshotAs(OutputType.FILE);
            String path = System.getProperty("user.dir") + "/screenshot/captcha.png";
            FileHandler.copy(src, new File(path));
        
            // Perform OCR on CAPTCHA image
            Tesseract tesseract = new Tesseract();
            tesseract.setDatapath("C:\\Users\\Shravani\\OneDrive\\Pictures\\Auto\\Forstu_Automation\\Elicpse\\123\\tessdata");
            String captcha = tesseract.doOCR(new File("C:\\Users\\Shravani\\OneDrive\\Pictures\\Auto\\Forstu_Automation\\Elicpse\\123\\screenshot\\captcha.png")).replaceAll("[^a-zA-Z0-9]", " ");
        
            Thread.sleep(2000);
        
            // Enter the CAPTCHA value
            driver.findElement(By.xpath("//*[@id=\"txtInput\"]")).sendKeys(captcha);
        
            Thread.sleep(2000);
        
            // Submit the login form
            WebElement submitButton = driver.findElement(By.id("login"));
            submitButton.click();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    public void logout() {
        // Perform logout actions
        // Implement your logout logic here
    }

    public static void main(String[] args) {
        JSONDataUploadTest jsonDataUploadTest = new JSONDataUploadTest();
        jsonDataUploadTest.setUp();

        try {
            // Read the JSON file
            JSONParser parser = new JSONParser();
            JSONArray jsonArray = (JSONArray) parser.parse(new FileReader("path/to/your/json/file.json"));

            // Login with the first user
            jsonDataUploadTest.login("username1", "password1");

            // Perform actions for the first user
            // ...

            // Logout
            jsonDataUploadTest.logout();

            // Login with the second user
            jsonDataUploadTest.login("username2", "password2");

            // Perform actions for the second user
            // ...

            // Logout
            jsonDataUploadTest.logout();
        } catch (Exception e) {
            e.printStackTrace();
        }

        jsonDataUploadTest.driver.quit();
    }
}
