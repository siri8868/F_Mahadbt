package JSonfiles;

import org.json.simple.JSONArray;
import org.json.simple.JSONObject;
import org.json.simple.parser.JSONParser;
import org.openqa.selenium.By;
import org.openqa.selenium.OutputType;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.chrome.ChromeOptions;
import org.openqa.selenium.io.FileHandler;

import net.sourceforge.tess4j.TesseractException;
import net.sourceforge.tess4j.ITesseract;
import net.sourceforge.tess4j.Tesseract;
import org.openqa.selenium.support.ui.WebDriverWait;

import java.io.File;
import java.io.FileReader;

public class JSONDataUploadTest {
    private WebDriver driver;

    public void setUp() {
        // Set the path to the chromedriver executable
        System.setProperty("webdriver.chrome.driver", "C:\\Users\\Shravani\\OneDrive\\Pictures\\Auto\\Forstu_Automation\\Browser Extention\\chromedriver.exe");
        // Initialize ChromeDriver instance
        ChromeOptions options = new ChromeOptions();
        options.addArguments("--remote-allow-origins=*");
        WebDriver driver = new ChromeDriver(options);
         driver.manage().window().maximize();
    }

    public void login(String username, String password) {
        try {
            // Open URL Of "Vidyasarthi"
            driver.get("https://www.vidyasaarathi.co.in/Vidyasaarathi/index");
        
            // Handle the PopUp
            driver.findElement(By.xpath("//*[@id=\"modalSocial\"]/div/div/div[3]/a")).click();
          
            // Login to Vidyasarthi
            driver.findElement(By.xpath("//*[@id=\"bs-example-navbar-collapse-1\"]/ul/li[8]/a")).click();
        
            // Switch to the new page
            String mainWindowHandle = driver.getWindowHandle();
            for (String handle : driver.getWindowHandles()) {
                if (!handle.equals(mainWindowHandle)) {
                    driver.switchTo().window(handle);
                    break;
                }
            }
        
            // Fill in the login credentials
            driver.findElement(By.id("username")).sendKeys(username);
            driver.findElement(By.name("password")).sendKeys(password);
            Thread.sleep(2000);
        
            // Capture CAPTCHA screenshot
            File src = driver.findElement(By.xpath("//*[@id=\"command\"]/div[8]/div[1]/div")).getScreenshotAs(OutputType.FILE);
            String path = System.getProperty("user.dir") + "/screenshot/captcha.png";
            FileHandler.copy(src, new File(path));
        
            // Perform OCR on CAPTCHA image
            Tesseract tesseract = new Tesseract();
            tesseract.setDatapath("C:\\Users\\Shravani\\OneDrive\\Pictures\\Auto\\Forstu_Automation\\Elicpse\\123\\tessdata");
            String captcha = tesseract.doOCR(new File("C:\\Users\\Shravani\\OneDrive\\Pictures\\Auto\\Forstu_Automation\\Elicpse\\123\\screenshot\\captcha.png")).replaceAll("[^a-zA-Z0-9]", " ");
        
            Thread.sleep(2000);
        
            // Enter the CAPTCHA value
            driver.findElement(By.xpath("//*[@id=\"txtInput\"]")).sendKeys(captcha);
        
            Thread.sleep(2000);
        
            // Submit the login form
            WebElement submitButton = driver.findElement(By.id("login"));
            submitButton.click();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    public void logout() {
        // Perform logout actions
        // Implement your logout logic here
    }

    public void readData(JSONObject userData) {
        // Extract user data from JSON object
        String name = (String) userData.get("name");
        String dateOfBirth = (String) userData.get("date_of_birth");
        String gender = (String) userData.get("gender");
        String category = (String) userData.get("category");
        String title = (String) userData.get("title");
        String fatherName = (String) userData.get("father_name");
        String guardian = (String) userData.get("guardian");
        String occupation = (String) userData.get("occupation");
        String contactNumber = (String) userData.get("contact_number");
        Long salary = (Long) userData.get("salary");
        String address = (String) userData.get("address");
        JSONObject emergencyContact = (JSONObject) userData.get("emergency_contact");
        String primaryEmergencyContact = (String) emergencyContact.get("primary");
        String secondaryEmergencyContact = (String) emergencyContact.get("secondary");

        // Perform data reading and display on the website
        // Implement your data reading logic and display on the website here

        // Output the read data
        System.out.println("User Data:");
        System.out.println("Name: " + name);
        System.out.println("Date of Birth: " + dateOfBirth);
        System.out.println("Gender: " + gender);
        System.out.println("Category: " + category);
        System.out.println("Title: " + title);
        System.out.println("Father Name: " + fatherName);
        System.out.println("Guardian: " + guardian);
        System.out.println("Occupation: " + occupation);
        System.out.println("Contact Number: " + contactNumber);
        System.out.println("Salary: " + salary);
        System.out.println("Address: " + address);
        System.out.println("Emergency Contact (Primary): " + primaryEmergencyContact);
        System.out.println("Emergency Contact (Secondary): " + secondaryEmergencyContact);
        System.out.println();
    }

    public static void main(String[] args) {
        JSONDataUploadTest jsonDataUploadTest = new JSONDataUploadTest();
        jsonDataUploadTest.setUp();

        try {
            // Read the JSON file
            JSONParser parser = new JSONParser();
            JSONArray jsonArray = (JSONArray) parser.parse(new FileReader("C:\\Users\\Shravani\\OneDrive\\Pictures\\Auto\\Forstu_Automation\\Elicpse\\123\\src\\main\\java\\JSonfiles\\Vidya.json"));

            // Login and read data for each user
            for (int i = 0; i < jsonArray.size(); i++) {
                JSONObject userData = (JSONObject) jsonArray.get(i);
                String username = userData.get("username").toString();
                String password = userData.get("password").toString();
                jsonDataUploadTest.login(username, password);
                jsonDataUploadTest.readData(userData);
                jsonDataUploadTest.logout();
            }
        } catch (Exception e) {
            e.printStackTrace();
        }

        jsonDataUploadTest.driver.quit();
    }
}
